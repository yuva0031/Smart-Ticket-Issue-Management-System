<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="header-content">
      <div class="title-group">
        <h1>Agent Dashboard</h1>
        <p class="subtitle">Manage your specialization and monitor workload</p>
      </div>
    </div>
  </header>

  <ng-container *ngIf="agentProfile(); else noProfile">
    <div class="dashboard-grid">
      
      <section class="profile-section">
        <mat-card class="styled-card profile-card">
          <mat-card-header>
            <div mat-card-avatar class="profile-avatar">
              <mat-icon>account_circle</mat-icon>
            </div>
            <mat-card-title>Status Overview</mat-card-title>
            <mat-card-subtitle>Live metrics</mat-card-subtitle>
          </mat-card-header>
          
          <mat-card-content>
            <div class="stats-grid">
              <div class="stat-item">
                <div class="stat-icon workload"><mat-icon>confirmation_number</mat-icon></div>
                <div class="stat-details">
                  <span class="stat-label">Workload</span>
                  <span class="stat-value">{{ agentProfile()?.currentWorkload }} <small>Tickets</small></span>
                </div>
              </div>
            </div>
            
            <div class="profile-footer">
              <span class="id-tag">ID: {{ agentProfile()?.id }}</span>
            </div>
          </mat-card-content>
        </mat-card>
      </section>

      <section class="skills-section">
        <mat-card class="styled-card skills-card">
          <mat-card-header>
            <mat-card-title>Technical Specializations</mat-card-title>
            <div class="header-actions">
              <button mat-flat-button 
                      [color]="isEditMode() ? 'warn' : 'primary'" 
                      (click)="toggleEditMode()">
                <mat-icon>{{ isEditMode() ? 'close' : 'edit' }}</mat-icon>
                {{ isEditMode() ? 'Cancel' : 'Manage Skills' }}
              </button>
            </div>
          </mat-card-header>

          <mat-card-content>
            <div class="chips-container">
              <div *ngIf="skills().length === 0" class="empty-state-inline">
                <mat-icon>category_off</mat-icon>
                <p>No skills assigned to your profile yet.</p>
              </div>

              <mat-chip-set aria-label="Agent skills">
                <mat-chip class="skill-chip" *ngFor="let skill of skills()">
                  <mat-icon matChipAvatar>verified</mat-icon>
                  {{ skill.categoryName }}
                  <button matChipRemove *ngIf="isEditMode()" (click)="removeSkill(skill)">
                    <mat-icon>cancel</mat-icon>
                  </button>
                </mat-chip>
              </mat-chip-set>
            </div>

            <div *ngIf="isEditMode()" class="edit-zone" [@fadeIn]>
              <mat-divider></mat-divider>
              <div class="edit-actions">
                <h3>Add Specialization</h3>
                <mat-form-field appearance="outline" class="full-width">
                  <mat-label>Available Categories</mat-label>
                  <mat-select (selectionChange)="addSkill($event.value)">
                    <mat-option *ngFor="let cat of availableCategories()" [value]="cat.id">
                      {{ cat.name }}
                    </mat-option>
                  </mat-select>
                  <mat-icon matPrefix>search</mat-icon>
                  <mat-hint>Select a category to add it instantly</mat-hint>
                </mat-form-field>

                <div *ngIf="availableCategories().length === 0" class="all-assigned-msg">
                  <mat-icon>task_alt</mat-icon>
                  <span>You have mastered all available categories!</span>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </section>

    </div>
  </ng-container>

  <ng-template #noProfile>
    <div class="full-page-error">
      <div class="error-visual">
        <mat-icon>account_box</mat-icon>
        <div class="dot"></div>
      </div>
      <h2>Profile Not Synchronized</h2>
      <p>We couldn't retrieve your agent details. Please reach out to your Support Manager.</p>
      <button mat-stroked-button color="primary" (click)="loadProfile()">
        <mat-icon>refresh</mat-icon> Try Again
      </button>
    </div>
  </ng-template>
</div>